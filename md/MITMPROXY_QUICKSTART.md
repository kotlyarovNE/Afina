# üéØ MIT Proxy - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ LLM API

## –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?

Mitmproxy –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–¥–µ—Ç—å **–≤—Å–µ HTTP/HTTPS –∑–∞–ø—Ä–æ—Å—ã** –æ—Ç –≤–∞—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∫ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º:
- ‚úÖ –ü–æ–ª–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã OpenAI, Anthropic, Google AI
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ–¥—ã –æ—à–∏–±–æ–∫
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–∏—Ç—å/–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: Python —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
python start_mitmproxy.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Shell —Å–∫—Ä–∏–ø—Ç
```bash
./monitor_llm.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í—Ä—É—á–Ω—É—é
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pip install mitmproxy

# –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
mitmweb --listen-port 8080 --web-port 8081
```

## üì± –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ: **http://127.0.0.1:8081**

**‚ùó –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è** –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞

### –°–ø–æ—Å–æ–± 1: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
export HTTP_PROXY=http://127.0.0.1:8080
export HTTPS_PROXY=http://127.0.0.1:8080

# –ó–∞–ø—É—Å–∫ –≤–∞—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞
python backend/start.py
```

### –°–ø–æ—Å–æ–± 2: –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ–∫—Å–∏
```bash
HTTP_PROXY=http://127.0.0.1:8080 HTTPS_PROXY=http://127.0.0.1:8080 python backend/start.py
```

### –°–ø–æ—Å–æ–± 3: –í –∫–æ–¥–µ Python
```python
import os
os.environ['HTTP_PROXY'] = 'http://127.0.0.1:8080'
os.environ['HTTPS_PROXY'] = 'http://127.0.0.1:8080'

# –ò–ª–∏ –¥–ª—è requests
import requests
proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}
response = requests.get('https://api.openai.com/...', proxies=proxies)
```

## üîç –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

–í –ø–æ–ª–µ "Filter" –≤–≤–µ–¥–∏—Ç–µ:

```
# –¢–æ–ª—å–∫–æ OpenAI
~d api.openai.com

# –¢–æ–ª—å–∫–æ Anthropic
~d api.anthropic.com

# –¢–æ–ª—å–∫–æ Google AI
~d generativelanguage.googleapis.com

# –í—Å–µ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
~d "api.openai.com|api.anthropic.com|generativelanguage.googleapis.com"

# –¢–æ–ª—å–∫–æ POST –∑–∞–ø—Ä–æ—Å—ã –∫ AI
~m POST ~d "openai.com|anthropic.com|googleapis.com"

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
~c 4xx

# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (>2 —Å–µ–∫)
~t ">2000"
```

## üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

### macOS
```bash
sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/.mitmproxy/mitmproxy-ca-cert.pem
```

### Linux
```bash
sudo cp ~/.mitmproxy/mitmproxy-ca-cert.pem /usr/local/share/ca-certificates/mitmproxy-ca-cert.crt
sudo update-ca-certificates
```

### Windows
1. –û—Ç–∫—Ä–æ–π—Ç–µ `mmc.exe` 
2. File ‚Üí Add/Remove Snap-in ‚Üí Certificates ‚Üí Add ‚Üí Computer account
3. Certificates ‚Üí Trusted Root ‚Üí Import ‚Üí `~/.mitmproxy/mitmproxy-ca-cert.pem`

## üí° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ mitmproxy**
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∫—Å–∏** –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞
3. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: http://127.0.0.1:8081
4. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä**: `~d api.openai.com`
5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–≥–µ–Ω—Ç–∞** - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å
6. **–£–≤–∏–¥—å—Ç–µ –∑–∞–ø—Ä–æ—Å –≤ mitmproxy!** üéâ

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å shell —Å–∫—Ä–∏–ø—Ç–æ–º

```bash
# –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
./monitor_llm.sh python backend/start.py
```

## üìä –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ

- **Request**: –ü–æ–ª–Ω—ã–π JSON –∑–∞–ø—Ä–æ—Å –∫ OpenAI/Anthropic
- **Response**: –û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏
- **Headers**: API –∫–ª—é—á–∏, User-Agent, –∏ —Ç.–¥.
- **Timing**: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
- **Size**: –†–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞

## üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞

–ù–∞–∂–º–∏—Ç–µ `Ctrl+C` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω mitmproxy

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
python start_mitmproxy.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –¢–µ—Å—Ç OpenAI
HTTP_PROXY=http://127.0.0.1:8080 python test_openai.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: –¢–µ—Å—Ç Anthropic
HTTP_PROXY=http://127.0.0.1:8080 python test_anthropic.py
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∞—à–µ–≥–æ —á–∞—Ç-–∞–≥–µ–Ω—Ç–∞
```bash
# –ó–∞–ø—É—Å–∫ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
HTTP_PROXY=http://127.0.0.1:8080 HTTPS_PROXY=http://127.0.0.1:8080 python backend/start.py
```

–¢–µ–ø–µ—Ä—å **–≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã** –≤–∞—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –≤ —É–¥–æ–±–Ω–æ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ! üéØ
